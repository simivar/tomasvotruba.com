<!DOCTYPE html>
<html lang="en">
    <head>
    <title>How to Find Dead Symfony Routes | Tomas Votruba</title>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    
    <link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/solid.css" integrity="sha384-wnAC7ln+XN0UKdcPvJvtqIH3jOjs9pnKnq9qX68ImXvOGz2JuFoEiCjT8jyZQX2z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/brands.css" integrity="sha384-nT8r1Kzllf71iZl81CdFzObMsaLOhqBU1JD2+XoAALbdtWaXDOlWOZTR4v1ktjPE" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/fontawesome.css" integrity="sha384-HbmWTHay9psM8qyzEKPc8odH4DsOuzdejtnr+OFtDmOcIVnhgReQ4GZBH7uwcjf6" crossorigin="anonymous">

        <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />

        <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />


        <link href="/assets/css/checklist.css" rel="stylesheet" type="text/css" />
</head>
    <body>
                <!-- post_id: 246 -->

        
<div class="hidden-sm-down">
    <nav class="navbar">
        <div class="container-fluid">
            <ul>
                <li id="logo">
                    <img src="https://avatars1.githubusercontent.com/u/924196?s=60&v=4" class="me_avatar">
                    Tomas Votruba
                </li>
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li class="">
                    <a href="/php-framework-trends">Trends</a>
                </li>
                <li class="">
                    <a href="/clusters">Clusters</a>
                </li>
                <li class="">
                    <a href="/projects">Projects</a>
                </li>
                <li class="">
                    <a href="/mission">Mission</a>
                </li>
                <li class="">
                    <a href="/talks">Talks</a>
                </li>
                <li class="">
                    <a href="/contact">Contact</a>
                </li>
                <li id="top-menu-search">
                    <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="hidden-md-up">
    <nav class="navbar" id="mobile-menu">
        <div class="container">
            <a href="/" class="col-3 col-sm-3 active">
                <em class="fas fa-book"></em>
                <br>
                Blog
            </a>


            <a href="/clusters" class="col-3 col-sm-3 ">
                <em class="fas fa-share-alt"></em>
                <br>
                Clusters
            </a>

            <a href="/projects" class="col-3 col-sm-3 ">
                <em class="fas fa-chart-bar"></em>
                <br>
                Trends
            </a>

            <a href="/contact" class="col-3 col-sm-3 ">
                <em class="fas fa-phone"></em>
                <br>
                Contact
            </a>
        </div>
    </nav>

    <div class="hidden-md-up text-center" id="top-menu-search-mobile">
        <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
    </div>
</div>

        <div class="mainContent">
            <div class="container-fluid" id="post">
                <h1>How to Find Dead Symfony Routes</h1>

                <ul class="list-inline post-metadata">
    <li class="list-inline-item mr-3">
        <em class="fas fa-clock fa-fw"></em>
        <strong>2 min</strong>
    </li>

    <li class="list-inline-item mr-3">
        <em class="fas fa-calendar fa-fw"></em>
        <time datetime="2020-04-Mon">
            <strike>
                            Mon, Apr 6
            
            </strike>        </time>
    </li>

            <li class="list-inline-item mr-3 text-success">
            <em class="fas fa-fw fa-sync"></em> Updated Apr, 2020
        </li>
    
            <li class="list-inline-item mr-3">
            <em class="fas fa-fw fa-comments"></em>
            <a href="/blog/2020/04/06/how-to-find-dead-symfony-routes/#disqus_thread">X</a> comments
        </li>
    
    
            <li class="list-inline-item mr-3 text-primary">
            <em class="fab fa-fw fa-github"></em>
            <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2020/2020-04-06-how-to-find-dead-symfony-routes.md">Edit Post</a>
        </li>
    </ul>

                
                                    <div class="card border-success card-bigger mt-5">
                        <div class="card-header text-white bg-success">
                            <strong>This post was updated at April 2020</strong>
                        </div>
                                                    <div class="card-body">
                                <p>Route visit table structure has changed and new command <code>show-dead-routes</code> was added.</p>
                            </div>
                                            </div>

                    <br>
                
                <div class="card card-bigger mb-5">
                    <div class="card-body">
                        <p>Almost half a year ago, I spotted a post called <a href="https://laravel-news.com/route-usage-package-for-laravel">Route Usage Package for Laravel</a>. It's nice to have to see what routes are used and how often.
<br>
<br>
But when dealing with legacy code, knowing <strong>dead routes will save you dozens of hours in refactoring</strong>.</p>
                    </div>
                </div>

                <h2 id="why-are-dead-routes-important-for-your-code">Why are Dead Routes Important for Your Code?</h2>
<p>If you know that 20 % is never used, you can <strong>drop it and ease your maintenance</strong>. Also, it's a must-have pre-step <a href="/blog/2019/12/16/8-steps-you-can-make-before-huge-upgrade-to-make-it-faster-cheaper-and-more-stable/">to code migrations</a>.</p>
<p><strong>Static analysis</strong> can help you with <a href="/blog/2019/03/18/how-to-detect-dead-php-code-in-code-review-in-7-snippets/">dead code that is never used</a> and with <a href="/blog/2019/03/14/remove-dead-public-methdos-from-your-code/">public methods that are never called</a>, e.g.:</p>
<pre><code class="language-diff">-$discount = $this-&gt;getDiscount();
 $productCategory = $this-&gt;categoryRepository-&gt;findCategoriesByProduct(
     $product-&gt;getCategory()
 );
 $discount = $this-&gt;getDiscount();</code></pre>
<p><br></p>
<blockquote class="blockquote text-center">
    10-20 % of code in most PHP code bases<br>
    is dead and can be deleted.
</blockquote>
<p>In this <a href="/blog/2019/12/09/how-to-get-rid-of-technical-debt-or-what-we-would-have-done-differently-2-years-ago/">case study from Spaceflow</a> project we worked in summer 2019, <strong>we removed ~20 % of the code... and nobody noticed</strong>.</p>
<img src="/assets/images/posts/2019/spaceflow_10_points/13.png" class="img-thumbnail">
<h2 id="static-analysis-of-dead-code-is-not-enough">Static Analysis of Dead Code is Not Enough</h2>
<p>It's quite easy to find dead calls, but when it comes to controller and API endpoints, it's a different game. Controller methods are public and are called by a framework.</p>
<p><strong>Static analysis won't tell us, which controller is used and which not.</strong> Also, the controller might call 2-3 other services... and they might call other services... and those could be dead too... <strong>welcome fractal of dead code we have to maintain.</strong> What now?</p>
<p>We'll have to use similar approach we used for <a href="/blog/2019/11/11/from-0-doc-types-to-full-type-declaration-with-dynamic-analysis/">From 0 Doc Types to Full Type Declaration</a>.</p>
<img src="/assets/images/posts/2020/dead_routes_branch.jpg" class="img-thumbnail mt-4 mb-2">
<p><em>Such branch is in your code... somewhere. Would you still water it for next couple years?</em></p>
<h2 id="coffee-shop-static-vs-dynamic-analysis">Coffee Shop - Static vs. Dynamic Analysis</h2>
<p>Imagine you're a coffee franchise owner. Not just 1, but 30 coffee houses. Suddenly, there comes corona, and shops have to be locked down.
Luckily, you have an emergency fund to keep them running... well, just 15 of them. <strong>Which one you choose to close?</strong></p>
<p>Coffee shop with a property of specific size, location, number of chairs, and toilets - that's static analysis. It won't help us here. What if the shop with the smallest area is making more money than the biggest one?</p>
<p>Let's use <strong>dynamic analysis</strong> here - you <strong>measure data in time</strong> and decide based on it. E.g., income for last year from all of them compared to expenses to run them.</p>
<h2 id="2-steps-to-add-route-usage-to-your-symfony-app">2 Steps to add Route Usage to Your Symfony App</h2>
<p>Inspired by the Laravel package, I've made a <a href="https://github.com/migrify/symfony-route-usage">Symfony Route Usage</a>.</p>
<h3 id="1-install-it">1. Install it</h3>
<pre><code class="language-bash">composer require migrify/symfony-route-usage</code></pre>
<h3 id="2-enable-bundle">2. Enable Bundle</h3>
<pre><code class="language-php">// config/bundles.php
return [
    Migrify\SymfonyRouteUsage\SymfonyRouteUsageBundle::class =&gt; ['all' =&gt; true],
];</code></pre>
<p><br></p>
<p>Collect data for a couple of weeks (depends on the size of your site) and see for yourself, <strong>what routes have been used</strong>:</p>
<pre><code class="language-bash">bin/console show-route-usage</code></pre>
<p>↓</p>
<img src="/assets/images/posts/2020/dead_routes_used_routes.png" class="img-thumbnail mt-4 mb-2">
<p><br></p>
<h2 id="what-routes-have-never-been-used">What Routes Have Never Been Used?</h2>
<p>Just run:</p>
<pre><code class="language-bash">bin/console show-dead-routes</code></pre>
<p>↓</p>
<img src="/assets/images/posts/2020/dead_routes_dead_routes.png" class="img-thumbnail mt-4 mb-2">
<p><br></p>
<p><strong>What about the performance?</strong> Pehapkari website takes 72 ms to load, of which 10 ms (13 %) is Symfony Route Visit. If that would be too much for your website, add partial logging by overloading <a href="https://github.com/migrify/symfony-route-usage/blob/master/src/EventSubscriber/LogRouteUsageEventSubscriber.php">the subscriber</a> - e.g., every 100th or 1000th request.</p>
<p><br></p>
<p>This package is freshly baked. Do you have some ideas how to make it better? Let me know ↓</p>
<p><br></p>
<p>Happy coding!</p>

                <br>

                <div class="row mb-5 mt-5">
                    <div class="col-12 mb-5">
                                                                            <a href="/blog/2020/03/30/dont-show-your-privates-to-public" class="d-block pt-4 pb-4 pl-4 pr-4 btn btn-success btn-wrappable">
                                <em class="fas fa-fw fa-forward"></em>
                                <strong>Read Next</strong>
                                <br>
                                <span class="text-bigger">
                                    Don&#039;t Show Your Privates to Public
                                </span>
                            </a>
                                            </div>

                    <div class="col-12">
                        <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2020/2020-04-06-how-to-find-dead-symfony-routes.md" class="d-block btn btn-dark btn-wrappable">
                            <em class="fab fa-fw fa-github"></em>
                            <strong>Found a typo?</strong> Fix it and join team of 99&nbsp;contributors
                        </a>
                    </div>
                </div>

                <br>

                <a name="comments"></a>
                <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>
        </div>

        <script src="/assets/js/jquery-3.3.1.slim.min.js"></script>
<script src="/assets/js/cluster-checklist.js"></script>
<script src="/assets/js/cluster-expanable.js"></script>

<script src="/assets/js/cleaning-lady-checklist.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

<script src="/assets/prism/prism.js"></script>

<script>
    // sortable table
    $('.sortable_table').DataTable({
        // see https://datatables.net/examples/basic_init/filter_only.html
        "searching": false,
        "paging": false,
        "info": false,
        "order": [[1, "desc"]],
        // see https://datatables.net/examples/advanced_init/sort_direction_control.html
        "aoColumns": [
            null,
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] }
        ]
    });
</script>

<div class="text-center mt-5" id="footer">
    <p>
        Thank you <a href="/thank-you">99 people</a>, who contributed this blog

        <span class="pl-2 pr-2">•</span>

        See <a href="/archive">Post Archive</a>
    </p>

    <br>

    <p>
        Did you know my daily focus goes to <strong>turning working with legacy code into joy</strong> again?

        <br>

        Mostly with awesome <a href="https://getrector.org/">instant refactoring tool called Rector</a>.
    </p>
</div>
    </body>
</html>

        <meta property="og:type" content="article" />
    <meta property="og:title" content="How to Find Dead Symfony Routes" />
    <meta property="og:description" content="Almost half a year ago, I spotted a post called [Route Usage Package for Laravel](https://laravel-news.com/route-usage-package-for-laravel). It&#039;s nice to have to see what routes are used and how often.


But when dealing with legacy code, knowing **dead routes will save you dozens of hours in refactoring**.
" />
    <meta property="og:url" content="/blog/2020/04/06/how-to-find-dead-symfony-routes" />

        <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@votrubaT">
    <meta name="twitter:title" content="How to Find Dead Symfony Routes" />
    <meta name="twitter:description" content="Almost half a year ago, I spotted a post called [Route Usage Package for Laravel](https://laravel-news.com/route-usage-package-for-laravel). It&#039;s nice to have to see what routes are used and how often.


But when dealing with legacy code, knowing **dead routes will save you dozens of hours in refactoring**.
" />
