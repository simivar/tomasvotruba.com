<!DOCTYPE html>
<html lang="en">
    <head>
    <title>Don&#039;t Show Your Privates to Public | Tomas Votruba</title>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    
    <link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/solid.css" integrity="sha384-wnAC7ln+XN0UKdcPvJvtqIH3jOjs9pnKnq9qX68ImXvOGz2JuFoEiCjT8jyZQX2z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/brands.css" integrity="sha384-nT8r1Kzllf71iZl81CdFzObMsaLOhqBU1JD2+XoAALbdtWaXDOlWOZTR4v1ktjPE" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/fontawesome.css" integrity="sha384-HbmWTHay9psM8qyzEKPc8odH4DsOuzdejtnr+OFtDmOcIVnhgReQ4GZBH7uwcjf6" crossorigin="anonymous">

        <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />

        <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />


        <link href="/assets/css/checklist.css" rel="stylesheet" type="text/css" />
</head>
    <body>
                <!-- post_id: 245 -->

        
<div class="hidden-sm-down">
    <nav class="navbar">
        <div class="container-fluid">
            <ul>
                <li id="logo">
                    <img src="https://avatars1.githubusercontent.com/u/924196?s=60&v=4" class="me_avatar">
                    Tomas Votruba
                </li>
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li class="">
                    <a href="/php-framework-trends">Trends</a>
                </li>
                <li class="">
                    <a href="/clusters">Clusters</a>
                </li>
                <li class="">
                    <a href="/projects">Projects</a>
                </li>
                <li class="">
                    <a href="/mission">Mission</a>
                </li>
                <li class="">
                    <a href="/talks">Talks</a>
                </li>
                <li class="">
                    <a href="/contact">Contact</a>
                </li>
                <li id="top-menu-search">
                    <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="hidden-md-up">
    <nav class="navbar" id="mobile-menu">
        <div class="container">
            <a href="/" class="col-3 col-sm-3 active">
                <em class="fas fa-book"></em>
                <br>
                Blog
            </a>


            <a href="/clusters" class="col-3 col-sm-3 ">
                <em class="fas fa-share-alt"></em>
                <br>
                Clusters
            </a>

            <a href="/projects" class="col-3 col-sm-3 ">
                <em class="fas fa-chart-bar"></em>
                <br>
                Trends
            </a>

            <a href="/contact" class="col-3 col-sm-3 ">
                <em class="fas fa-phone"></em>
                <br>
                Contact
            </a>
        </div>
    </nav>

    <div class="hidden-md-up text-center" id="top-menu-search-mobile">
        <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
    </div>
</div>

        <div class="mainContent">
            <div class="container-fluid" id="post">
                <h1>Don't Show Your Privates to Public</h1>

                <ul class="list-inline post-metadata">
    <li class="list-inline-item mr-3">
        <em class="fas fa-clock fa-fw"></em>
        <strong>4 min</strong>
    </li>

    <li class="list-inline-item mr-3">
        <em class="fas fa-calendar fa-fw"></em>
        <time datetime="2020-03-Mon">
            
                            Mon, Mar 30
            
            </strike>        </time>
    </li>

    
            <li class="list-inline-item mr-3">
            <em class="fas fa-fw fa-comments"></em>
            <a href="/blog/2020/03/30/dont-show-your-privates-to-public/#disqus_thread">X</a> comments
        </li>
    
    
            <li class="list-inline-item mr-3 text-primary">
            <em class="fab fa-fw fa-github"></em>
            <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2020/2020-03-30-dont-show-your-privates-to-public.md">Edit Post</a>
        </li>
    </ul>

                
                
                <div class="card card-bigger mb-5">
                    <div class="card-body">
                        <p>With typed properties in PHP 7.4, there comes <strong>a natural tendency for using properties as public</strong>. The type check is already there, right? It's a dangerous path that opens the door to static code with public properties everywhere, that is asking for a change in any place.
<br>
<br></p>
<p>But is that ok to show privates to the public?</p>
                    </div>
                </div>

                <p>Last week you probably spotted <strong><a href="https://wiki.php.net/rfc/constructor_promotion">RFC: Constructor Promotion</a></strong> proposed by my favorite mentor <a href="https://github.com/nikic">Nikita Popov</a>. This RFC counters <em>public property by default</em> approach and <strong>reduces the redundant code at the same time</strong>.</p>
<p><br></p>
<p>Another counter point for public properties or methods nailed <a href="https://thephp.cc/company/consultants/stefan-priebsch">Stefan Priebsch</a>:</p>
<img src="/assets/images/posts/2020/privates_meme.jpg" class="img-thumbnail">
<h2 id="how-many-public-methods-has-your-project">How Many Public Methods Has Your Project?</h2>
<p>That meme had just 1 public method. But what about real projects?</p>
<p>To get <strong>real numbers from a real project</strong>, I run <a href="https://matthiasnoback.nl/2019/09/using-phploc-for-quick-code-quality-estimation-part-1">phploc</a> to measure size of <a href="https://github.com/rectorphp/rector">Rector's code</a>.</p>
<pre><code class="language-bash">phploc src packages rules --exclude tests</code></pre>
<p>These are <strong>the results</strong>:</p>
<pre><code class="language-bash">Size
  Non-Comment Lines of Code (NCLOC)              99033 (85.46%)

Structure
  Methods                                         5185
    Visibility
      Public Methods                              3516 (67.81%)</code></pre>
<p><br></p>
<p>Let's put 100 children in one square:</p>
<img src="/assets/images/posts/2020/privates_100_children.jpg" class="img-thumbnail">
<p>This <strong>is 3 500 children</strong>:</p>
<img src="/assets/images/posts/2020/privates_3500_children.jpg" class="img-thumbnail">
<p>There is <a href="https://github.com/rectorphp/rector/blob/master/docs/AllRectorsOverview.md">~480 Rector rules</a>, each has 3 public methods required by interface contract. That's 1 500 public contract methods. Even if we remove thos, 3 500 - 1 500, we still have <strong>over 2 000 public methods</strong>:</p>
<img src="/assets/images/posts/2020/privates_2000_children.jpg" class="img-thumbnail">
<p>Good luck with getting all your 2 000 children to university... or bed ... or make them breakfast for them... for one day. No pressure, right?</p>
<h2 id="how-to-take-care-for-as-few-children-as-possible">How to Take Care for as Few Children as Possible?</h2>
<p>We want to reduce the number of public methods to a minimum. How?</p>
<h3 id="1-a-method-by-method-human-refactoring">1. A Method by Method Human Refactoring</h3>
<p>We can go for a method by method refactoring with careful analysis if the method should be public or private and how we can change it to private. <strong>It takes time, patience, attention, human performance and doesn't scale on massive projects.</strong> That's way too expensive.</p>
<p><em class="fas fa-fw fa-times text-danger fa-lg"></em></p>
<p>What simpler way can we apply today on an any-sized project? What low hanging fruit can we focus on?</p>
<h3 id="2-fake-public-method-detection">2. Fake Public Method Detection</h3>
<p>What is <em>fake public</em> method, property, or constant?</p>
<pre><code class="language-php">&lt;?php

declare(strict_types=1);

final class SomeController
{
    /**
     * @Route(path="/")
     */
    public function homepage()
    {
        return $this-&gt;prepareData();
    }

    public function prepareData(): array
    {
        return ['status' =&gt; 'quarantine'];
    }
}</code></pre>
<p>Can you see it?</p>
<pre><code class="language-diff">+public function prepareData(): array
-private function prepareData(): array</code></pre>
<p><em class="fas fa-fw fa-check text-success fa-2x"></em></p>
<p><br></p>
<p>Same applies for constants and properties, that is <strong>used only locally in the class they're defined in</strong>:</p>
<pre><code class="language-php">&lt;?php

declare(strict_types=1);

final class AirCleaner
{
    public const NAME = 'cleaner';

    public function getName()
    {
        return self::NAME;
    }
}</code></pre>
<pre><code class="language-diff">-public const NAME = 'cleaner';
+private const NAME = 'cleaner';</code></pre>
<p><em class="fas fa-fw fa-check text-success fa-2x"></em></p>
<p>The most common <em>false publics</em> are constants because they're <a href="https://wiki.php.net/rfc/class_const_visibility">last that got visibility in PHP 7.1</a>.</p>
<h2 id="why-should-we-care-about-privatization">Why Should We Care about Privatization?</h2>
<p>&quot;Nice intellectual exercise, Tom, but nothing more,&quot; you may think, and close this post and go back to your quarantine work.</p>
<p>But remember our children:</p>
<blockquote class="blockquote text-center">
    A public method is like a child: Once you've written it,<br>
    you are going to maintain it for the rest of its life.
</blockquote>
<p>What happens if we don't care about it? Well, <strong><code>public</code> element is designed to be used somewhere else.</strong></p>
<p>Same way <code>static</code> method is a method to be used everywhere (and <a href="/blog/2018/04/26/how-i-got-into-static-trap-and-made-fool-of-myself">then slowly kill you</a>/).</p>
<p><br></p>
<p>It's easy to spot now because we focus on ten lines of code, we knew that's a controller method only, and that's a clear miss-use. But in the real world, <strong>we don't have so much time to think about 10 lines of code</strong>.</p>
<p><br></p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">10 lines of code = 10 issues.<br><br>500 lines of code = "looks fine."<br><br>Code reviews.</p>— I Am Devloper (@iamdevloper) <a href="https://twitter.com/iamdevloper/status/397664295875805184?ref_src=twsrc%5Etfw">November 5, 2013</a></blockquote>
<p><br></p>
<p>Limited attention span is one of the reasons. We had plenty of such potential <em>legacy back doors</em> in Rector:</p>
<img src="/assets/images/posts/2020/privates_sample.png" class="img-thumbnail">
<h2 id="unused-method">Unused Method</h2>
<p>Another reason is that <strong>the method is completely unused</strong>, but PHPStorm won't tell you because it is <code>public</code>. When we turned this method into <code>private</code>, we saw it's unused, and we got rid of it:</p>
<img src="/assets/images/posts/2020/privates_sample_2.png" class="img-thumbnail">
<h2 id="not-used-method">Not-Used Method</h2>
<p>The effect of privatization is surprising. Take this case:</p>
<img src="/assets/images/posts/2020/privates_sample_3.png" class="img-thumbnail">
<p>How can the privatization of methods lead to more code? Easily. The method was <code>public</code>, but never used. After Rector run it was <code>private</code>, but never used and then removed... and that could work.</p>
<p>Actually, that was not a feature, it was a bug. <strong>This method should have been used many months ago.</strong> So we used it in the right place, the feature was complete, and potential future bug.</p>
<p><br></p>
<p>Do you want to know all the possible code changes?</p>
<p><a href="https://github.com/rectorphp/rector/pull/3084/commits/626287ec76ed16d15136115e1510b2154c2712a9" class="btn btn-dark btn-sm">
<em class="fab fa-github fa-fw"></em>
See pull-request
</a></p>
<h2 id="in-ci-pipeline-or-won-t-happen">In CI pipeline, or Won't Happen</h2>
<p>What now? Go to your code and check method one by one clicking on them in PHPStorm to <em>Find Usages</em>, if they're used somewhere else or <em>false public</em> and should be private. It will make your code much more robust and senior.</p>
<p>Just kidding. Just use new Rector set <code>privatization</code> locally and it to your CI:</p>
<pre><code class="language-bash">vendor/bin/rector process src --set privatization</code></pre>
<p>It has now 4 rules:</p>
<ul>
<li><strong>privatize local-only constant</strong></li>
<li><strong>privatize local-only property</strong></li>
<li><strong>privatize local-only method</strong></li>
<li><strong>privatize local getter to local property</strong></li>
</ul>
<p>Do you have an idea for another privatization rule? <a href="https://github.com/rectorphp/rector/issues/new?template=2_Feature_request.md">Let us know on GitHub</a>.</p>
<p>Stay lazy and alive!</p>
<p><br></p>
<p>Happy coding!</p>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

                <br>

                <div class="row mb-5 mt-5">
                    <div class="col-12 mb-5">
                                                                            <a href="/blog/2020/03/23/doctrine-entity-typed-properties-with-php74" class="d-block pt-4 pb-4 pl-4 pr-4 btn btn-success btn-wrappable">
                                <em class="fas fa-fw fa-forward"></em>
                                <strong>Read Next</strong>
                                <br>
                                <span class="text-bigger">
                                    Doctrine Entity Typed Properties With PHP 7.4
                                </span>
                            </a>
                                            </div>

                    <div class="col-12">
                        <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2020/2020-03-30-dont-show-your-privates-to-public.md" class="d-block btn btn-dark btn-wrappable">
                            <em class="fab fa-fw fa-github"></em>
                            <strong>Found a typo?</strong> Fix it and join team of 99&nbsp;contributors
                        </a>
                    </div>
                </div>

                <br>

                <a name="comments"></a>
                <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>
        </div>

        <script src="/assets/js/jquery-3.3.1.slim.min.js"></script>
<script src="/assets/js/cluster-checklist.js"></script>
<script src="/assets/js/cluster-expanable.js"></script>

<script src="/assets/js/cleaning-lady-checklist.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

<script src="/assets/prism/prism.js"></script>

<script>
    // sortable table
    $('.sortable_table').DataTable({
        // see https://datatables.net/examples/basic_init/filter_only.html
        "searching": false,
        "paging": false,
        "info": false,
        "order": [[1, "desc"]],
        // see https://datatables.net/examples/advanced_init/sort_direction_control.html
        "aoColumns": [
            null,
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] }
        ]
    });
</script>

<div class="text-center mt-5" id="footer">
    <p>
        Thank you <a href="/thank-you">99 people</a>, who contributed this blog

        <span class="pl-2 pr-2">•</span>

        See <a href="/archive">Post Archive</a>
    </p>

    <br>

    <p>
        Did you know my daily focus goes to <strong>turning working with legacy code into joy</strong> again?

        <br>

        Mostly with awesome <a href="https://getrector.org/">instant refactoring tool called Rector</a>.
    </p>
</div>
    </body>
</html>

        <meta property="og:type" content="article" />
    <meta property="og:title" content="Don&#039;t Show Your Privates to Public" />
    <meta property="og:description" content="With typed properties in PHP 7.4, there comes **a natural tendency for using properties as public**. The type check is already there, right? It&#039;s a dangerous path that opens the door to static code with public properties everywhere, that is asking for a change in any place.



But is that ok to show privates to the public?
" />
    <meta property="og:url" content="/blog/2020/03/30/dont-show-your-privates-to-public" />

        <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@votrubaT">
    <meta name="twitter:title" content="Don&#039;t Show Your Privates to Public" />
    <meta name="twitter:description" content="With typed properties in PHP 7.4, there comes **a natural tendency for using properties as public**. The type check is already there, right? It&#039;s a dangerous path that opens the door to static code with public properties everywhere, that is asking for a change in any place.



But is that ok to show privates to the public?
" />
