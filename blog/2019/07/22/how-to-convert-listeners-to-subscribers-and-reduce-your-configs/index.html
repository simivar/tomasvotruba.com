<!DOCTYPE html>
<html lang="en">
    <head>
    <title>How to Convert Listeners to Subscribers and Reduce your Configs | Tomas Votruba</title>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    
    <link rel="alternate" type="application/rss+xml" title="Tomas Votruba Blog RSS" href="/rss.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/solid.css" integrity="sha384-wnAC7ln+XN0UKdcPvJvtqIH3jOjs9pnKnq9qX68ImXvOGz2JuFoEiCjT8jyZQX2z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/brands.css" integrity="sha384-nT8r1Kzllf71iZl81CdFzObMsaLOhqBU1JD2+XoAALbdtWaXDOlWOZTR4v1ktjPE" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/fontawesome.css" integrity="sha384-HbmWTHay9psM8qyzEKPc8odH4DsOuzdejtnr+OFtDmOcIVnhgReQ4GZBH7uwcjf6" crossorigin="anonymous">

        <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css" />

        <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />


        <link href="/assets/css/checklist.css" rel="stylesheet" type="text/css" />
</head>
    <body>
                <!-- post_id: 219 -->

        
<div class="hidden-sm-down">
    <nav class="navbar">
        <div class="container-fluid">
            <ul>
                <li id="logo">
                    <img src="https://avatars1.githubusercontent.com/u/924196?s=60&v=4" class="me_avatar">
                    Tomas Votruba
                </li>
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li class="">
                    <a href="/php-framework-trends">Trends</a>
                </li>
                <li class="">
                    <a href="/clusters">Clusters</a>
                </li>
                <li class="">
                    <a href="/projects">Projects</a>
                </li>
                <li class="">
                    <a href="/mission">Mission</a>
                </li>
                <li class="">
                    <a href="/talks">Talks</a>
                </li>
                <li class="">
                    <a href="/contact">Contact</a>
                </li>
                <li id="top-menu-search">
                    <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="hidden-md-up">
    <nav class="navbar" id="mobile-menu">
        <div class="container">
            <a href="/" class="col-3 col-sm-3 active">
                <em class="fas fa-book"></em>
                <br>
                Blog
            </a>


            <a href="/clusters" class="col-3 col-sm-3 ">
                <em class="fas fa-share-alt"></em>
                <br>
                Clusters
            </a>

            <a href="/projects" class="col-3 col-sm-3 ">
                <em class="fas fa-chart-bar"></em>
                <br>
                Trends
            </a>

            <a href="/contact" class="col-3 col-sm-3 ">
                <em class="fas fa-phone"></em>
                <br>
                Contact
            </a>
        </div>
    </nav>

    <div class="hidden-md-up text-center" id="top-menu-search-mobile">
        <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="tomasvotruba.com" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Search..." autocomplete="off"/>
</form>
    </div>
</div>

        <div class="mainContent">
            <div class="container-fluid" id="post">
                <h1>How to Convert Listeners to Subscribers and Reduce your Configs</h1>

                <ul class="list-inline post-metadata">
    <li class="list-inline-item mr-3">
        <em class="fas fa-clock fa-fw"></em>
        <strong>4 min</strong>
    </li>

    <li class="list-inline-item mr-3">
        <em class="fas fa-calendar fa-fw"></em>
        <time datetime="2019-07-Mon">
            <strike>
                            Mon, Jul 22, 2019
            
            </strike>        </time>
    </li>

            <li class="list-inline-item mr-3 text-success">
            <em class="fas fa-fw fa-sync"></em> Updated Aug, 2020
        </li>
    
            <li class="list-inline-item mr-3">
            <em class="fas fa-fw fa-comments"></em>
            <a href="/blog/2019/07/22/how-to-convert-listeners-to-subscribers-and-reduce-your-configs/#disqus_thread">X</a> comments
        </li>
    
    
            <li class="list-inline-item mr-3 text-primary">
            <em class="fab fa-fw fa-github"></em>
            <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2019/2019-07-22-how-to-convert-listeners-to-subscribers-and-reduce-your-configs.md">Edit Post</a>
        </li>
    </ul>

                
                                    <div class="card border-success card-bigger mt-5">
                        <div class="card-header text-white bg-success">
                            <strong>This post was updated at August 2020</strong>
                        </div>
                                                    <div class="card-body">
                                <p>Updated Rector YAML to PHP configuration, as current standard.</p>
                            </div>
                                            </div>

                    <br>
                
                <div class="card card-bigger mb-5">
                    <div class="card-body">
                        <p>I wrote <a href="/blog/2019/05/16/don-t-ever-use-listeners/">Don't Ever use Symfony Listeners</a> 2 months ago (if you missed it, be sure to read it to better understand this 2nd part). It got many constructive comments, mostly focused on particular standalone sentences without context.
<br>
<br>
To my surprise, <strong>none of the comments shown that listener beats subscriber</strong>.<br>
But what can you do, if you'd like to try subscribers, but currently have over 100 listeners in your application?</p>
                    </div>
                </div>

                <h2 id="2-ways-to-do-one-thing-wtf-why-tf">2 Ways to do One Thing? = WTF! WHY TF?</h2>
<p>Just a reminder, how hurtful is to teach people <strong>2 very similar ways to do one thing</strong>.</p>
<p>Google shows that people are confused since 2012, wow!</p>
<img src="/assets/images/posts/2019/listen-to-sub/github.png" class="img-thumbnail">
<img src="/assets/images/posts/2019/listen-to-sub/quote.png" class="img-thumbnail">
<img src="/assets/images/posts/2019/listen-to-sub/so.png" class="img-thumbnail">
<p>And this is not related only to big patterns as subscriber or listener. We do such decisions every day - while we code a new feature when we add a new package to <code>composer.json</code> when we integrate 4th API to verify payments.</p>
<p>Next time you'll be standing before 2 options, remember <a href="/blog/2019/07/01/5-workflow-tips-every-php-developer-should-know/#5-use-elementary-maths-to-become-master">the least common denominator</a> and <strong>make your code more durable</strong> in time.</p>
<h2 id="why-should-we-re-think-listeners-in-our-code">Why Should we Re-Think Listeners in our Code?</h2>
<p>If the readable and clear code is not good enough reason for you and you still think
you should stick with listeners at all cost, maybe the following steps will convince you.</p>
<p>Symfony 3.3 introduced <a href="/blog/2017/05/07/how-to-refactor-to-new-dependency-injection-features-in-symfony-3-3/">PSR-4 Autodiscovery</a> of services. In short, it means we don't have register services manually, if they respect PSR-4 (class name ~= file location):</p>
<pre><code class="language-diff"> services:
-    App\Controller\CoffeeController: ~
-    App\Controller\WifiController: ~
-    App\Controller\PlaneController: ~
-    # thousands more...

+    App\Controller\:
+        resource: '../src/Controller'</code></pre>
<h2 id="how-to-migrate-listeners-to-subscribers">How to Migrate Listeners to Subscribers?</h2>
<p>It doesn't apply only to controllers, but to all services, like Event Subscribers:</p>
<pre><code class="language-diff"> services:
     _defaults:
         # this helps load event subscribers to EventDistpatcher
         autoconfigure: true

-    App\EventSubscriber\CoffeeEventSubscriber: ~
-    App\EventSubscriber\WifiEventSubscriber: ~
-    App\EventSubscriber\PlaneEventSubscriber: ~
-    # thousands more...

+    App\EventSubscriber\:
+        resource: '../src/EventSubscriber'</code></pre>
<p>Next time we create an event subscriber class, we don't have to <a href="/blog/2019/02/14/why-config-coding-sucks/">code in config</a> anymore <em class="fas fa-fw fa-lg fa-check text-success"></em></p>
<p>We've <a href="/blog/2018/05/21/is-your-code-readable-by-humans-cognitive-complexity-tells-you/">reduced cognitive load</a> → code is easier to work with → hiring is faster → we can focus on business and feature value.</p>
<h3 id="how-can-we-reduce-configs-with-listeners">How can we Reduce configs with Listeners?</h3>
<pre><code class="language-yaml">services:
    App\EventListener\WifiEventListener:
        tags:
            - { name: kernel.event_listener, event: kernel.exception }
            - { name: kernel.event_listener, event: kernel.view }</code></pre>
<p>Well, what about...</p>
<pre><code class="language-yaml">services:
    App\EventListener\:
        resource: '../src/EventListener'</code></pre>
<p>Hm, how can be the listener called when it has now an information event?</p>
<p>That's one of legacy <a href="/blog/2017/02/12/drop-all-service-tags-in-your-nette-and-symfony-applications/">code smells of tags</a>.</p>
<p><strong>We can't reduce configs</strong>. We have to grow about configs together with code till the end of times <em class="fas fa-fw fa-2x fa-times text-danger fa-lg"></em></p>
<p><br></p>
<p>If <strong>you're paid or motivated by productivity</strong> like me and not by produced lines of code or wasted time with no output, you care about this.</p>
<h2 id="automated-instant-migration">Automated Instant Migration</h2>
<p>It's very nice use case for <a href="/blog/2019/04/15/pattern-refactoring/">pattern refactoring</a>, from A - <em>Listener</em> to B - <em>Event Subscriber</em>.</p>
<h3 id="1-define-patterns">1. Define Patterns</h3>
<p>A. <strong>Listener</strong></p>
<ul>
<li>it's a naked PHP class with a public method</li>
<li>event information (event, method, priority) is in a config</li>
</ul>
<p>B. <strong>Event Subscriber</strong></p>
<ul>
<li>it's a PHP class that implements <code>Symfony\Component\EventDispatcher\EventSubscriberInterface</code></li>
<li>event information is in a static method <code>getSubscribedEvents</code> inside the class</li>
<li>it is auto-discovered by PSR-4</li>
</ul>
<h3 id="2-pattern-change-in-code">2. Pattern Change In Code?</h3>
<pre><code class="language-php">&lt;?php

class SomeListener
{
     public function methodToBeCalled()
     {
     }
}</code></pre>
<pre><code class="language-yaml"># in config.yaml
services:
    SomeListener:
        tags:
            - { name: kernel.event_listener, event: 'some_event', method: 'methodToBeCalled' }</code></pre>
<p>↓</p>
<pre><code class="language-php">&lt;?php
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class SomeEventSubscriber implements EventSubscriberInterface
{
     /**
      * @return mixed[]
      */
     public static function getSubscribedEvents(): array
     {
         return ['some_event' =&gt; 'methodToBeCalled'];
     }

     public function methodToBeCalled()
     {
     }
}</code></pre>
<p>Without any config.</p>
<h3 id="3-instant-upgrade-with-rector">3. Instant Upgrade with Rector</h3>
<p>The latest <a href="https://twitter.com/rectorphp/status/1152862370630459393">Rector v0.5.8 is shipped</a> with rule exactly for this kind of migration.</p>
<p>Just register the rule in your <code>rector.php</code> config to start migration:</p>
<pre><code class="language-php">&lt;?php

// rector.php

declare(strict_types=1);

use Rector\SymfonyCodeQuality\Rector\Class_\EventListenerToEventSubscriberRector;
use Symfony\Component\DependencyInjection\Loader\Configurator\ContainerConfigurator;

return function (ContainerConfigurator $containerConfigurator): void {
    $services = $containerConfigurator-&gt;services();
    $services-&gt;set(EventListenerToEventSubscriberRector::class);

    // optional, when something fails
    $parameters = $containerConfigurator-&gt;parameters();
    // use explicit Kernel, if not discovered by Rector
    $parameters-&gt;set('kernel_class', 'App\Kernel');
    // use explicit environment, if not found by Rector
    $parameters-&gt;set('kernel_environment', 'test');
};

Run it:

```bash
vendor/bin/rector process app src</code></pre>
<p>And now all the listeners were migrated to event subscribers <em class="fas fa-fw fa-lg fa-check text-success"></em></p>
<h3 id="4-update-configs">4. Update Configs</h3>
<p>In the end, we have to remove all listeners + metadata from configs and add single autodiscovery for our EventSubscribers:</p>
<pre><code class="language-diff">services:
-    App\EventListener\WifiEventListener:
-        tags:
-            - { name: kernel.event_listener, event: kernel.exception }
-            - { name: kernel.event_listener, event: kernel.view }

+    _defaults:
+        autoconfigure: true
+
+    App\EventSubscriber\:
+        resource: '../src/EventSubscriber'</code></pre>
<p>That's it!</p>
<p><br></p>
<p>Happy coding!</p>

                <br>

                <div class="row mb-5 mt-5">
                    <div class="col-12 mb-5">
                                                                            <a href="/blog/2019/07/15/why-use-one-time-migration-scripts" class="d-block pt-4 pb-4 pl-4 pr-4 btn btn-success btn-wrappable">
                                <em class="fas fa-fw fa-forward"></em>
                                <strong>Read Next</strong>
                                <br>
                                <span class="text-bigger">
                                    Why use One-Time Migration Scripts
                                </span>
                            </a>
                                            </div>

                    <div class="col-12">
                        <a href="https://github.com/tomasvotruba/tomasvotruba.com/edit/master/packages/blog/config/data/2019/2019-07-22-how-to-convert-listeners-to-subscribers-and-reduce-your-configs.md" class="d-block btn btn-dark btn-wrappable">
                            <em class="fab fa-fw fa-github"></em>
                            <strong>Found a typo?</strong> Fix it and join team of 99&nbsp;contributors
                        </a>
                    </div>
                </div>

                <br>

                <a name="comments"></a>
                <div id="disqus_thread"></div>

<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://itsworthsharing.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <script id="dsq-count-scr" src="https://itsworthsharing.disqus.com/count.js" async defer></script>
        </div>

        <script src="/assets/js/jquery-3.3.1.slim.min.js"></script>
<script src="/assets/js/cluster-checklist.js"></script>
<script src="/assets/js/cluster-expanable.js"></script>

<script src="/assets/js/cleaning-lady-checklist.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-46082345-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

<script src="/assets/prism/prism.js"></script>

<script>
    // sortable table
    $('.sortable_table').DataTable({
        // see https://datatables.net/examples/basic_init/filter_only.html
        "searching": false,
        "paging": false,
        "info": false,
        "order": [[1, "desc"]],
        // see https://datatables.net/examples/advanced_init/sort_direction_control.html
        "aoColumns": [
            null,
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] },
            { "orderSequence": [ "desc", "asc" ] }
        ]
    });
</script>

<div class="text-center mt-5" id="footer">
    <p>
        Thank you <a href="/thank-you">99 people</a>, who contributed this blog

        <span class="pl-2 pr-2">•</span>

        See <a href="/archive">Post Archive</a>
    </p>

    <br>

    <p>
        Did you know my daily focus goes to <strong>turning working with legacy code into joy</strong> again?

        <br>

        Mostly with awesome <a href="https://getrector.org/">instant refactoring tool called Rector</a>.
    </p>
</div>
    </body>
</html>

        <meta property="og:type" content="article" />
    <meta property="og:title" content="How to Convert Listeners to Subscribers and Reduce your Configs" />
    <meta property="og:description" content="I wrote [Don&#039;t Ever use Symfony Listeners](/blog/2019/05/16/don-t-ever-use-listeners/) 2 months ago (if you missed it, be sure to read it to better understand this 2nd part). It got many constructive comments, mostly focused on particular standalone sentences without context.


To my surprise, **none of the comments shown that listener beats subscriber**.
But what can you do, if you&#039;d like to try subscribers, but currently have over 100 listeners in your application?
" />
    <meta property="og:url" content="/blog/2019/07/22/how-to-convert-listeners-to-subscribers-and-reduce-your-configs" />

        <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@votrubaT">
    <meta name="twitter:title" content="How to Convert Listeners to Subscribers and Reduce your Configs" />
    <meta name="twitter:description" content="I wrote [Don&#039;t Ever use Symfony Listeners](/blog/2019/05/16/don-t-ever-use-listeners/) 2 months ago (if you missed it, be sure to read it to better understand this 2nd part). It got many constructive comments, mostly focused on particular standalone sentences without context.


To my surprise, **none of the comments shown that listener beats subscriber**.
But what can you do, if you&#039;d like to try subscribers, but currently have over 100 listeners in your application?
" />
